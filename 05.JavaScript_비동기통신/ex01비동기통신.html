<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <!-- 영화정보를 보여주는 태그 -->
    <div id="movie-info"></div> 

    
    <button id="req-button">데이터 요청</button>


    <!-- 외부 라이브러리 사용 시 불러오는 것 먼저하기! -->
    <!-- 스크립트의 scr: 어디에 있는 파일인지 경로 찾기 *src = 경로찾기! -->
    <script src="./js/jquery-3.7.0.js"></script>
    <!-- 스크립트를 새로 만든 이유? 외부 파일 불러오면 불러오는 용도의 스크립트만 사용가능! -->
    <script>
        //$ : jQeury객체
        //ajex() : 비동기통신을 사용하기 위한 함수(메소드) 
        //success: 서버의 응답이 왔을 때 처리하는 함수. 이벤트 핸들러


        // 1) $ajax({}) : {} 안에 값이 들어가면 객체. 그러므로 ajex는 객체 형태의 데이터를 넣게 되어있음!
        // 2) url 요청은 문자열로
        // 3) success는 함수 실행되도록 화살표 함수 -> 알람으로 요청성공!
        // 4) 혹은 그 아래 쉼표로 error!
        // 5) ex) 영화진흥위원회 오픈 api를 가져와서 xml(눈에 보기 편하니 파일크기가 크다)
        // 반면 json은 자바스크립트에서 쓰기 편하다! 객체 형태로 되어있어서 바로 가져올 수 있음
        // 6) json parser 검색해서 json 파일을 보기 편하게 변환해준다.
        // 위에서부터 아래로 [0] 검색 후 movieNm 이런식으로 검색 
        
        const movieInfo = document.getElementById("movie-info");
        const reqButton = document.getElementById("req-button"); //1) 콘스트로 다큐먼트에 버튼을 가져옴!
        const movieURL = "https://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json?key=f5eef3421c602c6cb7ea224104795888&targetDt=20230621"

        const getMovieData = () => { 

                $.ajax({
                url:movieURL,
                success:(result /*json 사용하기 위해 성공했을 때의 함수의 매개변수를 만들어줘야함.*/)=>{
                    alert("요청성공!"/*json형태로 인식 js에서는 객체로 인식하므로 object*/);
                    // console.log(result /*alert가 아닌 콘솔에 찍어보면 정보!*/);
                    // console.log(result.boxOfficeResult);
                    console.log(result.boxOfficeResult.dailyBoxOfficeList); //위에서부터 아래로 타고 들어간다.
                    
                    let movieList = result.boxOfficeResult.dailyBoxOfficeList; //변수로 담아두는 게 편할 것이다.

                    //박스오피스 순위, 영화명, 개봉일자 정보를 가져온 후 웹페이지에 출력해보기!
                    

                    //ul, li요소, Text 생성하기
                    let ul = document.createElement("ul"); //createElement를 왜 붙이는지???

                    for(let i=0; i<movieList.length;/*길이는 변수명.length*/ i++){
                        console.log(movieList[i].rank,/*홈페이지에 속성이름*/ movieList[i].movieNm, movieList[i].openDt);
                        // 왜 [i]? 변수 안에서 0부터 10까지 배열 중 속성이름을 찾아서 들어가는 것!
                        let li = document.createElement("li");

                        //document.createTextNode(생성할 내용) : 내용 객체를 생성해주는 함수
                         let content = document.createTextNode(`${movieList[i].rank}.${movieList[i].movieNm}(${movieList[i].openDt})`);


                        // 속석노드 생성
                        let idAttr = document.createAttribute("id");

                        // 속성노드에 값 초기화
                        idAttr.value = `list${i+1}`;

                        //속성노드 --> 요소노드에 추가하기
                        li.setAttributeNode(idAttr);



                         // 1. text --> li에 붙이기 (부모노드.appendChild(자식노드))
                          li.appendChild(content);    

                        // 2. li --> ul에 붙이기 
                            ul.appendChild(li);


                    }
                
                    //3. ul --> div#movie-info에 붙이기
                    movieInfo.appendChild(ul);

                },
                error:()=>{
                    alert("요청실패..!");
                }
            });

        } //2)//여기에 ajax를 모두 넣는다. 버튼이 작동되도록 하기 위해 클릭이벤트 안에 넣을 함수를 만든다.

        reqButton.addEventListener("click", getMovieData); //3) 클릭이벤트를 만들어주고 적용할 함수를 넣어준다.
    </script>




</body>
</html>